# å¾®ä¿¡ç¾¤èŠæ¯æ—¥æŠ¥å‘Šç”Ÿæˆå™¨

è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„å¾®ä¿¡ç¾¤èŠè®°å½•åˆ†æå·¥å…·ï¼Œå¯ä»¥æ¯å¤©è‡ªåŠ¨æ‹‰å–æŒ‡å®šç¾¤èŠçš„èŠå¤©è®°å½•ï¼Œä½¿ç”¨AIè¿›è¡Œæ™ºèƒ½æ€»ç»“ï¼Œå¹¶ç”Ÿæˆç»“æ„åŒ–çš„æ—¥æŠ¥å‘é€ç»™ç”¨æˆ·ã€‚

## ğŸŒŸ åŠŸèƒ½ç‰¹ç‚¹

- ğŸ¤– **æ™ºèƒ½æ€»ç»“**: æ”¯æŒOpenAI GPTã€Google Geminiç­‰AIæœåŠ¡å¯¹èŠå¤©è®°å½•è¿›è¡Œæ™ºèƒ½åˆ†æå’Œæ€»ç»“
- ğŸ“± **å¤šç¾¤ç›‘æ§**: å¯åŒæ—¶ç›‘æ§å¤šä¸ªå¾®ä¿¡ç¾¤èŠ
- â° **è‡ªåŠ¨åŒ–è¿è¡Œ**: æ”¯æŒcronå’Œsystemdå®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Š
- ğŸ“§ **å¤šç§é€šçŸ¥æ–¹å¼**: æ”¯æŒé‚®ä»¶ã€æ§åˆ¶å°è¾“å‡ºã€æ€æºç¬”è®°ç­‰å¤šç§æŠ¥å‘Šå‘é€æ–¹å¼
- ğŸ”§ **çµæ´»é…ç½®**: æ”¯æŒæœ¬åœ°ç®€å•æ€»ç»“å’ŒAIæ™ºèƒ½æ€»ç»“ä¸¤ç§æ¨¡å¼
- ğŸ“Š **ç»“æ„åŒ–æŠ¥å‘Š**: ç”ŸæˆåŒ…å«ç¾¤èŠæ´»è·ƒåº¦ã€æ ¸å¿ƒè¯é¢˜ã€FAQã€å¾…è·Ÿè¿›äº‹é¡¹ç­‰çš„ç»“æ„åŒ–æŠ¥å‘Š
- ğŸ““ **æ€æºç¬”è®°é›†æˆ**: è‡ªåŠ¨ä¿å­˜æŠ¥å‘Šåˆ°æ€æºç¬”è®°ï¼Œæ”¯æŒç»“æ„åŒ–å­˜å‚¨å’Œæ ‡ç­¾ç®¡ç†

## ğŸ“‹ é¡¹ç›®ç»“æ„

```
wechat_daily_report/
â”œâ”€â”€ main.py                 # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ requirements.txt        # Pythonä¾èµ–
â”œâ”€â”€ .env.example           # é…ç½®æ–‡ä»¶æ¨¡æ¿
â”œâ”€â”€ setup_scheduler.sh     # å®šæ—¶ä»»åŠ¡è®¾ç½®è„šæœ¬
â”œâ”€â”€ src/                   # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ wechat_client.py   # å¾®ä¿¡APIå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ summarizer.py      # AIæ€»ç»“æœåŠ¡
â”‚   â”œâ”€â”€ report_generator.py # æŠ¥å‘Šç”Ÿæˆå™¨
â”‚   â””â”€â”€ siyuan_client.py   # æ€æºç¬”è®°å®¢æˆ·ç«¯
â”œâ”€â”€ templates/             # æŠ¥å‘Šæ¨¡æ¿
â”œâ”€â”€ reports/              # ç”Ÿæˆçš„æŠ¥å‘Šæ–‡ä»¶
â””â”€â”€ logs/                 # æ—¥å¿—æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- **Python**: 3.8+
- æœ¬åœ°è¿è¡Œçš„å¾®ä¿¡èŠå¤©è®°å½•APIæœåŠ¡ (http://127.0.0.1:5030)
- (å¯é€‰) OpenAI APIå¯†é’¥æˆ–Google Gemini APIå¯†é’¥ç”¨äºæ™ºèƒ½æ€»ç»“
- (å¯é€‰) æ€æºç¬”è®°è½¯ä»¶ç”¨äºæŠ¥å‘Šå­˜å‚¨

### 2. å®‰è£…ä¾èµ–

```bash
# å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®åˆ°æœ¬åœ°
cd wechat_daily_report

# å®‰è£…Pythonä¾èµ–
pip install -r requirements.txt
```

### 3. é…ç½®è®¾ç½®

```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vi .env  # æˆ–ä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨
```

é…ç½®æ–‡ä»¶è¯´æ˜ï¼š

```bash
# APIè®¾ç½®
WECHAT_API_BASE_URL=http://127.0.0.1:5030
WECHAT_API_TIMEOUT=30

# ç›®æ ‡ç¾¤èŠï¼ˆç”¨é€—å·åˆ†éš”ç¾¤åæˆ–ç¾¤IDï¼‰
TARGET_GROUPS=ä»Šå¤©HRè¢«é¸½äº†å—ğŸ¶,å·¥ä½œç¾¤,æœ‹å‹åœˆ

# AIæœåŠ¡è®¾ç½®
AI_SERVICE=gemini  # å¯é€‰: openai, gemini, local
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_MODEL=gpt-4o-mini
GEMINI_API_KEY=your_gemini_api_key_here
GEMINI_MODEL=gemini-1.5-flash

# é‚®ä»¶é€šçŸ¥è®¾ç½®
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASSWORD=your_app_password
NOTIFICATION_EMAIL=your_email@gmail.com

# æ€æºç¬”è®°é›†æˆ
SIYUAN_ENABLED=true
SIYUAN_BASE_URL=http://127.0.0.1:6806
SIYUAN_NOTEBOOK_ID=20250207155248-so9nz4m
SIYUAN_AUTH_TOKEN=your_siyuan_api_token
SIYUAN_SAVE_INDIVIDUAL_GROUPS=false

# æŠ¥å‘Šè®¾ç½®
MAX_MESSAGES_PER_GROUP=200
```

### 4. æµ‹è¯•è¿è¡Œ

```bash
# æµ‹è¯•APIè¿æ¥å’Œé…ç½®
python main.py --test

# æ‰‹åŠ¨ç”ŸæˆæŠ¥å‘Š
python main.py

# ç”ŸæˆæŒ‡å®šæ—¥æœŸçš„æŠ¥å‘Š
python main.py --date 2023-12-01
```

### 5. è®¾ç½®è‡ªåŠ¨åŒ–å®šæ—¶ä»»åŠ¡

```bash
# è¿è¡Œå®šæ—¶ä»»åŠ¡è®¾ç½®è„šæœ¬
chmod +x setup_scheduler.sh
./setup_scheduler.sh
```

æˆ–æ‰‹åŠ¨è®¾ç½®cronä»»åŠ¡ï¼š

```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ æ¯å¤©æ—©ä¸Š8ç‚¹è¿è¡Œçš„ä»»åŠ¡
0 8 * * * cd /path/to/wechat_daily_report && python main.py
```

## ğŸ“– è¯¦ç»†ä½¿ç”¨è¯´æ˜

### AIæœåŠ¡é…ç½®

#### 1. OpenAIæ¨¡å¼
```bash
AI_SERVICE=openai
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4o-mini  # æˆ– gpt-4
```

#### 2. Google Geminiæ¨¡å¼ (æ¨è)
```bash
AI_SERVICE=gemini
GEMINI_API_KEY=your_gemini_api_key_here
GEMINI_MODEL=gemini-1.5-flash  # æˆ– gemini-1.5-pro
```

**Geminiä¼˜åŠ¿**ï¼š
- ğŸ’° æˆæœ¬æ›´ä½
- âš¡ å¤„ç†é€Ÿåº¦å¿«
- ğŸ“„ æ”¯æŒæ›´é•¿çš„ä¸Šä¸‹æ–‡

#### 3. æœ¬åœ°æ¨¡å¼ (æ— éœ€APIå¯†é’¥)
```bash
AI_SERVICE=local
```

### ç¾¤èŠé…ç½®

åœ¨`TARGET_GROUPS`ä¸­é…ç½®è¦ç›‘æ§çš„ç¾¤èŠï¼Œæ”¯æŒï¼š
- ç¾¤èŠæ˜µç§°ï¼š`ä»Šå¤©HRè¢«é¸½äº†å—ğŸ¶`
- ç¾¤èŠIDï¼š`24254678513@chatroom`

### æ€æºç¬”è®°é›†æˆ

**åŠŸèƒ½ç‰¹ç‚¹**ï¼š
- ğŸ—‚ï¸ **ä¼˜åŒ–ç›®å½•ç»“æ„**ï¼šæ—¥æŠ¥æ‰å¹³åŒ–å­˜å‚¨ (`/å¾®ä¿¡ç¾¤èŠæ—¥æŠ¥/2024-01-15-æ—¥æŠ¥`)
- ğŸ“ **ç¾¤èŠåˆ†ç±»å­˜å‚¨**ï¼šæŒ‰ç¾¤èŠåç§°åˆ†æ–‡ä»¶å¤¹ (`/å¾®ä¿¡ç¾¤èŠæ—¥æŠ¥/ç¾¤èŠæŠ¥å‘Š/å·¥ä½œç¾¤/2024-01-15.md`)
- ğŸ“Š **æ•°æ®ç»Ÿè®¡è¡¨æ ¼**ï¼šåŒ…å«å„ç¾¤èŠæ¶ˆæ¯æ•°é‡å’Œå¤„ç†çŠ¶æ€
- ğŸ·ï¸ **æ™ºèƒ½æ ‡ç­¾**ï¼šè‡ªåŠ¨æ·»åŠ æ—¥æœŸã€ç±»å‹ç­‰æ ‡ç­¾ä¾¿äºæ£€ç´¢
- ğŸ”— **æ–‡æ¡£å…³è”**ï¼šæ”¯æŒç›¸å…³æ–‡æ¡£çš„é“¾æ¥å¼•ç”¨
- ğŸ“ **æ ¼å¼ä¼˜åŒ–**ï¼šä¸“ä¸ºæ€æºç¬”è®°ä¼˜åŒ–çš„Markdownæ ¼å¼

**é…ç½®æ­¥éª¤**ï¼š

1. **è·å–ç¬”è®°æœ¬ID**ï¼š
   - æ‰“å¼€æ€æºç¬”è®°
   - åœ¨è®¾ç½® â†’ å…³äº â†’ ç¬”è®°æœ¬åˆ—è¡¨ä¸­æ‰¾åˆ°ç›®æ ‡ç¬”è®°æœ¬ID

2. **è·å–API Token**ï¼š
   - æ€æºç¬”è®°è®¾ç½® â†’ API â†’ ç”ŸæˆToken
   - å°†Tokené…ç½®åˆ°`SIYUAN_AUTH_TOKEN`

3. **é…ç½®ç¤ºä¾‹**ï¼š
```bash
SIYUAN_ENABLED=true
SIYUAN_BASE_URL=http://127.0.0.1:6806
SIYUAN_NOTEBOOK_ID=20250207155248-so9nz4m
SIYUAN_AUTH_TOKEN=p5jtu1bzgwwx7wdk
SIYUAN_SAVE_INDIVIDUAL_GROUPS=false  # æ˜¯å¦ä¸ºæ¯ä¸ªç¾¤èŠåˆ›å»ºå•ç‹¬æ–‡æ¡£
```

### é‚®ä»¶é€šçŸ¥é…ç½®

æ”¯æŒGmailç­‰SMTPæœåŠ¡ï¼š

```bash
# Gmailé…ç½®ç¤ºä¾‹
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASSWORD=your_app_password  # ä½¿ç”¨åº”ç”¨ä¸“ç”¨å¯†ç 
```

**Gmailè®¾ç½®æ­¥éª¤**ï¼š
1. å¯ç”¨ä¸¤æ­¥éªŒè¯
2. ç”Ÿæˆåº”ç”¨ä¸“ç”¨å¯†ç 
3. ä½¿ç”¨åº”ç”¨å¯†ç è€Œéè´¦æˆ·å¯†ç 

### æŠ¥å‘Šæ¨¡æ¿è‡ªå®šä¹‰

å¯ä»¥åœ¨`templates/daily_report.md`ä¸­è‡ªå®šä¹‰æŠ¥å‘Šæ¨¡æ¿ï¼š

```markdown
# {{ report_date }} å¾®ä¿¡ç¾¤èŠæ—¥æŠ¥

**ç”Ÿæˆæ—¶é—´**: {{ generation_time }}

{% for summary in summaries %}
{{ summary.summary }}
{% endfor %}
```

## ğŸ“Š ç”Ÿæˆçš„æŠ¥å‘Šæ ¼å¼

### ç»“æ„åŒ–æ€»ç»“åŒ…å«ï¼š

- **ğŸ“Š ç¾¤èŠæ¦‚å†µ**ï¼šå‚ä¸äººæ•°ã€æ¶ˆæ¯ç»Ÿè®¡ã€æ´»è·ƒæ—¶é—´
- **ğŸ”¥ æ ¸å¿ƒè¯é¢˜**ï¼šæŒ‰é‡è¦æ€§æ’åºçš„ä¸»è¦è®¨è®ºå†…å®¹
- **ğŸ’¡ æœ‰ä»·å€¼ä¿¡æ¯**ï¼šé‡è¦é€šçŸ¥ã€èµ„æºåˆ†äº«ã€ç»éªŒæ€»ç»“
- **â“ FAQå¸¸è§é—®é¢˜**ï¼šè‡ªåŠ¨æ•´ç†çš„é—®ç­”å†…å®¹
- **ğŸ¯ å¾…è·Ÿè¿›äº‹é¡¹**ï¼šéœ€è¦åç»­å…³æ³¨çš„ä»»åŠ¡æ¸…å•
- **ğŸ“ å¤‡æ³¨**ï¼šå…¶ä»–å€¼å¾—å…³æ³¨çš„ä¿¡æ¯

### ç¤ºä¾‹æŠ¥å‘Šç‰‡æ®µï¼š

```markdown
## ğŸ“Š ç¾¤èŠæ¦‚å†µ
- **ç¾¤èŠåç§°**: äº§å“è®¨è®ºç¾¤
- **æ´»è·ƒæˆå‘˜**: 12äºº
- **æ¶ˆæ¯æ€»æ•°**: 156æ¡
- **æ—¶é—´è·¨åº¦**: 2024-01-15 09:00 ~ 18:30

## ğŸ”¥ æ ¸å¿ƒè¯é¢˜

1. **æ–°ç‰ˆæœ¬åŠŸèƒ½è§„åˆ’**: 
   - æ ¸å¿ƒå†…å®¹: è®¨è®ºV2.0ç‰ˆæœ¬çš„æ ¸å¿ƒåŠŸèƒ½ç‚¹
   - ä¸»è¦è§‚ç‚¹: ä¼˜å…ˆçº§åº”è¯¥æ”¾åœ¨ç”¨æˆ·ä½“éªŒä¼˜åŒ–ä¸Š
   - å‚ä¸è®¨è®º: å¼ ä¸‰ã€æå››ã€ç‹äº”

## â“ FAQ å¸¸è§é—®é¢˜

**Q1**: æ–°åŠŸèƒ½ä»€ä¹ˆæ—¶å€™ä¸Šçº¿ï¼Ÿ
**A1**: é¢„è®¡ä¸‹ä¸ªæœˆåº•å®Œæˆå¼€å‘ï¼Œä¸‹ä¸‹ä¸ªæœˆåˆå‘å¸ƒ

## ğŸ¯ å¾…è·Ÿè¿›äº‹é¡¹
- [ ] ç¡®è®¤UIè®¾è®¡æ–¹æ¡ˆ (å¼ ä¸‰è´Ÿè´£)
- [ ] åˆ¶å®šæµ‹è¯•è®¡åˆ’ (æå››è´Ÿè´£)
```

## ğŸ”§ APIæ¥å£è¯´æ˜

æœ¬é¡¹ç›®åŸºäº [chatlog](https://github.com/sjzar/chatlog) é¡¹ç›®çš„APIæ¥å£ï¼š

- `/api/v1/chatlog` - è·å–èŠå¤©è®°å½•
- `/api/v1/chatroom` - è·å–ç¾¤èŠåˆ—è¡¨
- `/api/v1/session` - è·å–ä¼šè¯åˆ—è¡¨

## â— æ•…éšœæ’é™¤

### 1. APIè¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥chatlogæœåŠ¡æ˜¯å¦è¿è¡Œ
curl http://127.0.0.1:5030/api/v1/session?format=json&limit=1&offset=0

# ç¡®ä¿ç«¯å£5030æœªè¢«å ç”¨
netstat -tlnp | grep 5030
```

### 2. æ‰¾ä¸åˆ°ç¾¤èŠ
```bash
# æŸ¥çœ‹æ‰€æœ‰ç¾¤èŠåˆ—è¡¨
python -c "
from src.wechat_client import WeChatAPIClient
client = WeChatAPIClient()
rooms = client.get_chat_rooms(limit=50)
for room in rooms:
    print(f'{room[\"name\"]} - {room[\"nickName\"]}')
"
```

### 3. æ€æºç¬”è®°è¿æ¥å¤±è´¥
- æ£€æŸ¥æ€æºç¬”è®°æ˜¯å¦åœ¨è¿è¡Œ
- ç¡®è®¤APIç«¯å£6806æ˜¯å¦å¼€æ”¾
- éªŒè¯ç¬”è®°æœ¬IDå’ŒAuth Tokenæ˜¯å¦æ­£ç¡®
- æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

### 4. é‚®ä»¶å‘é€å¤±è´¥
- æ£€æŸ¥SMTPé…ç½®æ˜¯å¦æ­£ç¡®
- ç¡®ä¿ä½¿ç”¨åº”ç”¨ä¸“ç”¨å¯†ç ï¼ˆè€Œéè´¦æˆ·å¯†ç ï¼‰
- ç¡®è®¤é˜²ç«å¢™æœªé˜»æ­¢SMTPç«¯å£

### 5. AIæœåŠ¡é”™è¯¯
- **OpenAI**: æ£€æŸ¥APIå¯†é’¥å’Œé¢åº¦
- **Gemini**: ç¡®è®¤APIå¯†é’¥æœ‰æ•ˆä¸”æœªè¶…é™é¢
- **æœ¬åœ°æ¨¡å¼**: æ— éœ€é¢å¤–é…ç½®

### 6. æŸ¥çœ‹æ—¥å¿—
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/wechat_reporter_$(date +%Y%m%d).log

# æŸ¥çœ‹cronæ—¥å¿—
tail -f logs/cron.log
```

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Linux, macOS, Windows
- **Python**: 3.8+
- **å†…å­˜**: æœ€å°‘512MB
- **å­˜å‚¨**: æœ€å°‘100MBå¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: éœ€è¦è®¿é—®AIæœåŠ¡APIï¼ˆå¦‚ä½¿ç”¨OpenAIæˆ–Geminiï¼‰

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

1. **é…ç½®æ–‡ä»¶å®‰å…¨**: `.env`æ–‡ä»¶åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œè¯·å‹¿æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
2. **APIå¯†é’¥ä¿æŠ¤**: å¦¥å–„ä¿ç®¡OpenAIã€Geminiç­‰APIå¯†é’¥
3. **ç½‘ç»œå®‰å…¨**: ç¡®ä¿å¾®ä¿¡APIæœåŠ¡ä»…åœ¨æœ¬åœ°ç½‘ç»œå¯è®¿é—®
4. **æ€æºç¬”è®°å®‰å…¨**: ä¿æŠ¤å¥½æ€æºç¬”è®°çš„API Token
5. **æ—¥å¿—å®¡è®¡**: å®šæœŸæ£€æŸ¥å’Œæ¸…ç†æ—¥å¿—æ–‡ä»¶

## ğŸ¯ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰AIæç¤ºè¯

å¯ä»¥ä¿®æ”¹`src/summarizer.py`ä¸­çš„`_build_prompt`æ–¹æ³•æ¥è‡ªå®šä¹‰AIåˆ†æé€»è¾‘ï¼š

```python
def _build_prompt(self, group_name: str, formatted_messages: str) -> str:
    return f"""
    è‡ªå®šä¹‰çš„æç¤ºè¯å†…å®¹...
    è¯·åˆ†æç¾¤èŠ '{group_name}' çš„èŠå¤©è®°å½•...
    """
```

### æ‰¹é‡å¤„ç†å†å²æ•°æ®

```bash
# ç”Ÿæˆè¿‡å»ä¸€å‘¨çš„æŠ¥å‘Š
for i in {1..7}; do
    date=$(date -d "$i days ago" +%Y-%m-%d)
    python main.py --date $date
done
```

### é›†æˆå…¶ä»–æœåŠ¡

å¯ä»¥æ‰©å±•`NotificationService`ç±»æ¥æ”¯æŒæ›´å¤šé€šçŸ¥æ–¹å¼ï¼š
- é’‰é’‰æœºå™¨äºº
- ä¼ä¸šå¾®ä¿¡
- Slack
- Discordç­‰

## ğŸ“ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

### è´¡çŒ®æŒ‡å—
1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·åˆ›å»ºIssueè¿›è¡Œåé¦ˆã€‚

### å¸¸è§é—®é¢˜
- æŸ¥çœ‹[Issuesé¡µé¢](../../issues)è·å–å¸¸è§é—®é¢˜è§£ç­”
- å‚è€ƒ[Wikiæ–‡æ¡£](../../wiki)è·å–æ›´å¤šä½¿ç”¨æŠ€å·§
- åŠ å…¥è®¨è®ºç»„äº¤æµä½¿ç”¨ç»éªŒ

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStaræ”¯æŒä¸€ä¸‹ï¼